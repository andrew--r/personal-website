---
layout: article
tags: [notes]
title: Windows и редактирование RTL-текста
description: "Однажды я столкнулся с жалобой на очень странное поведение: на Windows переключение раскладки клавиатуры меняло направление всего набранного текста."
date: 2020-05-23
---
<p class="subtitle">В моём рабочем проекте поддерживается ввод текста на <abbr title="Right-to-left">RTL</abbr>-языках. Реализуется это добавлением атрибута <code>dir="auto"</code> к полям ввода. Однажды я столкнулся с жалобой на очень странное поведение: на Windows переключение раскладки клавиатуры меняло направление всего набранного текста.</p>

Ситуация следующая: пользователь пишет текст на арабском, браузер корректно распознаёт направление текста и отображает его справа налево. В какой-то момент пользователю нужно написать фрагмент текста <span class="nobr">по-английски</span>, и при переключении раскладки весь набранный текст меняет направление с <abbr title="Right-to-left">RTL</abbr> на <abbr title="Left-to-right">LTR</abbr>. Приходится копировать набранный текст и перезагружать страницу, чтобы восстановить корректное направление.

После исследования контекста и поисков в интернете я выяснил источник проблемы. Стандартное сочетание клавиш для переключения раскладки было изменено пользователем на <kbd>Ctrl</kbd> + <kbd>Shift</kbd>. В то же время в Windows сочетания клавиш <kbd>Ctrl</kbd> + <kbd>Left Shift</kbd> и <kbd>Ctrl</kbd> + <kbd>Right Shift</kbd> [меняют направление набираемого текста](https://superuser.com/a/471699) на <abbr title="Left-to-right">LTR</abbr> и <abbr title="Right-to-left">RTL</abbr> соответственно. Поэтому при переключении раскладки также срабатывало изменение направления текста.

Я долго искал в интернете способ отключить это сочетание клавиш на Windows (судя по вопросам на форумах, этим озадачился не только я), но так ничего и не нашёл. Поэтому на уровне системы эта проблема лечится, похоже, только сменой сочетания клавиш для переключения раскладки.

Эту проблему можно предотвратить на уровне приложения, если вы заранее знаете направление текста, который будет вводиться в конкретное поле. Явное задание направления текста через атрибут `dir` в разметке не помогает, а вот задание `direction` через CSS — помогает. Чтобы не заморачиваться каждый раз со стилями, я продолжил пользоваться атрибутом `dir`, но добавил в таблицу стилей глобальное правило:

```css
[dir="rtl"] {
  direction: rtl;
}
```
